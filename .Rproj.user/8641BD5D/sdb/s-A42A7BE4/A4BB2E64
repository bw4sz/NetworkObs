{
    "contents" : "sink(\"Bayesian/Multi_RW.jags\")\ncat(\"\n    model{\n    \n    #Constants\n    pi <- 3.141592653589\n    \n    ##argos observation error##\n    argos_prec[1:2,1:2] <- inverse(argos_sigma*argos_cov[,])\n    \n    #Constructing the covariance matrix\n    argos_cov[1,1] <- 1\n    argos_cov[1,2] <- sqrt(argos_alpha) * rho\n    argos_cov[2,1] <- sqrt(argos_alpha) * rho\n    argos_cov[2,2] <- argos_alpha\n    \n    for(i in 1:ind){\n\n    ###First Step###\n\n    ## Priors for first true location -> this is wrong, conflates observation and process error.\n    #for lat long\n    y[i,1,1:2] ~ dmnorm(argos[i,1,1,1:2],argos_prec)\n\n    #First movement - random walk.\n    y[i,2,1:2] ~ dmnorm(y[i,1,1:2],iSigma)\n    \n    ###First Behavioral State###\n    state[i,1] ~ dcat(lambda[]) ## assign state for first obs\n    \n    #Process Model for movement\n    for(t in 2:(steps[i]-1)){\n    \n    #Behavioral State at time T\n    logit(phi[i,t,1]) <- lalpha[i,state[i,t-1]] + lbeta[i,state[i,t-1]] * ocean[i,t]\n    phi[i,t,2] <- 1-phi[i,t,1]\n    state[i,t] ~ dcat(phi[i,t,])\n        \n    #Turning covariate\n    #Transition Matrix for turning angles\n    T[i,t,1,1] <- cos(theta[state[i,t]])\n    T[i,t,1,2] <- (-sin(theta[state[i,t]]))\n    T[i,t,2,1] <- sin(theta[state[i,t]])\n    T[i,t,2,2] <- cos(theta[state[i,t]])\n    \n    #Correlation in movement change\n    d[i,t,1:2] <- y[i,t,] + gamma[state[i,t]] * T[i,t,,] %*% (y[i,t,1:2] - y[i,t-1,1:2])\n    \n    #Gaussian Displacement\n    y[i,t+1,1:2] ~ dmnorm(d[i,t,1:2],iSigma)\n    }\n\n    #Final behavior state\n    logit(phi[i,steps[i],1]) <- lalpha[i,state[i,steps[i]-1]] + lbeta[i,state[i,steps[i]-1]] * ocean[i,steps[i]]\n    phi[i,steps[i],2] <- 1-phi[i,steps[i],1]\n    state[i,steps[i]] ~ dcat(phi[i,steps[i],])\n    \n    ##\tMeasurement equation - irregular observations\n    # loops over regular time intervals (t)    \n    \n    for(t in 2:steps[i]){\t\t\t\t\t\n    \n    # loops over observed locations within interval t\n    for(u in 1:idx[i,t]){ \n      zhat[i,t,u,1:2] <- (1-j[i,t,u]) * y[i,t-1,1:2] + j[i,t,u] * y[i,t,1:2]\n\n        #for each lat and long\n          #argos error\n          argos[i,t,u,1:2] ~ dmnorm(zhat[i,t,u,1:2],argos_prec)\n        }\t\n      }\n    }\n    \n    ###Priors###\n\n    #Process Variance\n    iSigma ~ dwish(R,2)\n    Sigma <- inverse(iSigma)\n    \n    ##Mean Angle\n    tmp[1] ~ dbeta(10, 10)\n    tmp[2] ~ dbeta(10, 10)\n    \n    # prior for theta in 'traveling state'\n    theta[1] <- (2 * tmp[1] - 1) * pi\n    \n    # prior for theta in 'foraging state'    \n    theta[2] <- (tmp[2] * pi * 2)\n    \n    ##Move persistance\n    # prior for gamma (autocorrelation parameter) in state 1\n    gamma[1] ~ dbeta(5,2)\n    \n    # prior for gamma in state 2\n    gamma[2] ~ dbeta(2,5)\n    \n    ##Behavioral States\n    # Following lunn 2012 p85\n    \n    #Hierarchical structure\n    #Intercepts\n    lalpha_mu[1] ~ dnorm(0,0.386)\n    lalpha_mu[2] ~ dnorm(0,0.386)\n\n    #Variance\n    lalpha_tau[1] ~ dt(0,1,1)I(0,)\n    lalpha_tau[2] ~ dt(0,1,1)I(0,)\n\n    #Slopes\n    lbeta_mu[1] ~ dnorm(0,0.386)\n    lbeta_mu[2] ~ dnorm(0,0.386)\n\n    #Variance\n    lbeta_tau[1] ~ dt(0,1,1)I(0,)\n    lbeta_tau[2] ~ dt(0,1,1)I(0,)\n    \n    #For each individual\n    for(i in 1:ind){\n      # prob of being in state 1 at t, given in state 1 at t-1    \n      #Individual Intercept\n      lalpha[i,1] ~ dnorm(lalpha_mu[1],lalpha_tau[1])\n      logit(alpha[i,1]) <- lalpha[i,1]\n      \n      #effect of ocean on traveling -> traveling\n      lbeta[i,1] ~ dnorm(lbeta_mu[1],lbeta_tau[1])\n      logit(beta[i,1]) <- lbeta[i,1]\n  \n      #Prob of transition to state 1 given state 2 at t-1\n      lalpha[i,2] ~ dnorm(lalpha_mu[2],lalpha_tau[2])\n      logit(alpha[i,2]) <- lalpha[i,2]\n      \n      #effect of ocean on feeding -> traveling\n      lbeta[i,2] ~ dnorm(lbeta_mu[2],lbeta_tau[2])\n      logit(beta[i,2]) <- lbeta[i,2]\n  \n    }\n    \n    #Probability of behavior switching \n    lambda[1] ~ dbeta(1,1)\n    lambda[2] <- 1 - lambda[1]\n\n    ##Argos priors##\n    #longitudinal argos error\n    argos_sigma ~ dunif(0,10)\n    \n    #latitidunal argos error\n    argos_alpha~dunif(0,10)\n    \n    #correlation in argos error\n    rho ~ dunif(-1, 1)\n    \n\n    }\"\n    ,fill=TRUE)\nsink()\n",
    "created" : 1465274040117.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3401719158",
    "id" : "A4BB2E64",
    "lastKnownWriteTime" : 1464388965,
    "path" : "~/Whales/Bayesian/MultiSpecies.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}